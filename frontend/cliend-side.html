<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Diabetic Retinopathy Report</title>
    <!-- Required Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        .download-btn {
            background: #2196F3;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 20px;
        }
        .download-btn:hover {
            background: #1976D2;
        }
    </style>
</head>
<body>
    <!-- Your Content -->
    <div id="report-content">
        <h1>Recommendation</h1>
        <p id="diagnosis-text">Proliferative diabetic retinopathy detected. Immediate consultation with an ophthalmologist is strongly recommended.</p>
        <img id="retinal-image" src="path/to/your/image.jpg" alt="Retinal Scan" width="400">
    </div>
    
    <button id="downloadReport" class="download-btn">Download Report</button>
    <button id="shareWithDoctor" class="download-btn">Share with Doctor</button>

    <script>
    document.getElementById('downloadReport').addEventListener('click', async () => {
        try {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Set document properties
            doc.setDocumentProperties({
                title: 'Diabetic Retinopathy Report',
                subject: 'Medical Report',
                author: 'RetinaScan AI'
            });

            // Header Section
            doc.setFontSize(20);
            doc.setFont('helvetica', 'bold');
            doc.text('Diabetic Retinopathy Report', 105, 20, { align: 'center' });

            // Date and Time
            doc.setFontSize(12);
            doc.text(`Generated: ${new Date().toLocaleString()}`, 105, 30, { align: 'center' });

            let yPosition = 40;

            // Diagnosis Text
            doc.setFontSize(14);
            const diagnosisText = document.getElementById('diagnosis-text').textContent;
            const splitDiagnosis = doc.splitTextToSize(diagnosisText, 180);
            doc.text(splitDiagnosis, 14, yPosition);
            yPosition += splitDiagnosis.length * 7 + 15;

            // Retinal Image
            try {
                const imageElement = document.getElementById('retinal-image');
                const canvas = await html2canvas(imageElement);
                const imgData = canvas.toDataURL('image/jpeg', 0.9);
                
                const imgWidth = 150;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                doc.addImage(imgData, 'JPEG', 14, yPosition, imgWidth, imgHeight);
                yPosition += imgHeight + 10;
            } catch (imageError) {
                console.error('Error capturing image:', imageError);
                doc.text('Image unavailable', 14, yPosition);
                yPosition += 10;
            }

            // Medical Disclaimer
            doc.setFontSize(10);
            doc.setFont('helvetica', 'italic');
            doc.text('* This AI-generated report must be reviewed by a qualified ophthalmologist.', 
                    14, yPosition, { maxWidth: 180 });

            // Save PDF
            doc.save(`Retina_Report_${Date.now()}.pdf`);
            
        } catch (error) {
            console.error('PDF Generation Error:', error);
            alert('Error generating report. Please try again.');
        }
    });
    </script>
</body>
</html>